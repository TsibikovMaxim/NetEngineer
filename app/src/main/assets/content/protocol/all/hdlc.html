<!DOCTYPE html>
<html>
<head>
	<!-- Charset -->
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>HDLC</title>
	<!-- Include meta tag to ensure proper rendering and touch zooming-->
	<meta name="view-port" content="width=device-width, initial-scale=1">
	<!-- Include jQuery Mobile stylesheets -->
	<link rel="stylesheet" href="../../../css/jquery.mobile-1.4.5.min.css" />
	<link rel="stylesheet" href="../../../css/themes/my-theme.css" />
	<link rel="stylesheet" href="../../../css/themes/jquery.mobile.icons.min.css" />
	<link rel="stylesheet" href="../../../css/my-style.css" />
	<!-- Include the jQuery Mobile library -->
	<script type="text/javascript" src="../../../js/jquery-1.11.3.min.js"></script>
	<!-- Include the jQuery Mobile library -->
	<script type="text/javascript" src="../../../js/jquery.mobile-1.4.5.min.js"></script>
	<!-- AdMob-->
	<script type="text/javascript" src="../../../js/admob.js"></script>
	<!-- cordova js -->
	<script src="../../../cordova.js"></script>
</head>
<body>

<div data-role="page" id="position" data-theme="a">

	<div data-role="header" data-position="fixed">
		<a data-role="button" data-rel="back" data-ajax="false" class="ui-nodisc-icon transparentButton" data-icon="carat-l" data-iconpos="notext" data-theme="a">Кнопка назад</a>
		<h1>Описание</h1>
		<a href="../../../index.html" data-ajax="false" class="ui-nodisc-icon transparentButton" data-role="button" data-icon="home" data-iconpos="notext" data-shadow="false" data-transition="none" data-theme="a">На главную</a>
	</div>

	<div data-role="main" class="ui-content">

		<h3>HDLC</h3>

		<p><strong>High-Level Data Link Control</strong> (HDLC) — бит-ориентированный протокол канального уровня сетевой модели OSI, разработанный ISO.</p>

		<p>Текущим стандартом для HDLC является ISO 13239.</p>

		<p>HDLC может быть использован в соединениях с множественным доступом, но в настоящее время в основном используется в соединениях точка-точка с использованием асинхронного сбалансированного режима (ABM).</p>

		<hr><h3>Типы станций</h3>

		<ul>
			<li>Первичная (ведущая) станция (Primary terminal) ответственна за управление каналом и восстановление его работоспособности. Она производит кадры команд. В соединениях точка-многоточка поддерживает отдельные связи с каждой из вторичных станций.</li>
			<li>Вторичная (ведомая) станция (Secondary terminal) работает под контролем ведущей, отвечая на её команды. Поддерживает только 1 сеанс связи.</li>
			<li>Комбинированная станция (Combined terminal) сочетает в себе функции как ведущей, так и ведомой станций. Производит и команды и ответы. Только соединения точка-точка.</li>
		</ul>

		<hr><h3>Логические состояния</h3>

		<p>Каждая из станций в каждый момент времени находится в одном из 3 логических состояний:</p>

		<ul>
			<li>Состояние логического разъединения (LDS — Logical Disconnect State)</li>
		</ul>

		<p>Если вторичная станция находится в режиме нормального разъединения (NDM), то она может принимать кадры только после получения явного разрешения от первичной. Если же в асинхронном режиме разъединения (ADM), то вторичная станция может самовольно инициировать передачу.</p>

		<ul>
			<li>Состояние инициализации (IS — Initialization State)</li>
		</ul>

		<p>Используется для передачи управления на удалённую комбинированную станцию и для обмена параметрами между удалёнными станциями.</p>

		<ul>
			<li>Состояние передачи информации (ITS — Information Transfer State)</li>
		</ul>

		<p>Всем станциям разрешено вести передачу и принимать информацию. Станции могут находиться в режимах NRM, ARM, ABM.</p>

		<hr><h3>Режимы состояния передачи</h3>

		<p>HDLC поддерживает три режима логического соединения, отличающиеся ролями взаимодействующих устройств:</p>

		<ul>
			<li>Режим нормального ответа (Normal Response Mode, NRM) требует инициации передачи в виде явного разрешения на передачу от первичной станции. После использования канала вторичной станцией (ответа на команду первичной), для продолжения передачи она обязана ждать другого разрешения. Для выбора права на передачу первичная станция проводит круговой опрос вторичных. Используется в основном в соединениях точка-многоточка.</li>
			<li>Режим асинхронного ответа (Asynchronous Response Mode, ARM) даёт возможность вторичной станции самой инициировать передачу. В основном используется в соединениях типа кольцо и многоточечных с неизменной цепочкой опроса, так как в этих соединениях одна вторичная станция может получить разрешение на передачу от другой вторичной и в ответ начать передачу. То есть разрешение на передачу передаётся по типу маркера (token). За первичной станцией сохраняются обязанности по инициализации линии, определению ошибок передачи и логическому разъединению. Позволяет уменьшить накладные расходы, связанные с началом передачи.</li>
			<li>Асинхронный сбалансированный режим (Asynchronous Balanced Mode, ABM) используется комбинированными станциями. Передача может быть инициирована с любой стороны, может происходить в полном дуплексе. В режиме ABM оба устройства равноправны и обмениваются кадрами, которые делятся на кадры-команды и кадры-ответы.</li>
		</ul>

		<hr><h3>Конфигурации канала</h3>

		<p>Для обеспечения совместимости между станциями, которые могут менять свой статус(тип), в протоколе HDLC предусмотрены 3 конфигурации канала:</p>

		<ul>
			<li>Несбалансированная конфигурация (UN — Unbalanced Normal) обеспечивает работу 1 первичной и одной или нескольких вторичных станций в (симплексном)полудуплексном и полнодуплексном режимах, с коммутируемым или некоммутируемым каналом.</li>
			<li>Симметричная конфигурация (UA — Unbalanced Asynchronous) обеспечивает взаимодействие двух двухточечных несбалансированных станций. Используется 1 канал передачи, в который мультиплексируются и команды и ответы. В данное время не используется.</li>
			<li>Сбалансированная конфигурация (BA — Balanced Asynchronous) состоит из 2 комбинированных станций. Передача в(симплексном) полудуплексном и полнодуплексном режимах, с коммутируемым или некоммутируемым каналом. Каждая станция несёт одинаковую ответственность за управление каналом.</li>
		</ul>

		<hr><h3>Кадры</h3>

		<p>Кадры HDLC можно передавать, используя синхронные и асинхронные соединения. В самих соединениях нет механизмов определения начала и конца кадра, для этих целей используется уникальная в пределах протокола битовая последовательность (FD — Frame Delimiter) '01111110'(0x7E в шестнадцатеричном представлении), помещаемая в начало и конец каждого кадра. Уникальность флага гарантируется использованием битстаффинга в синхронных соединениях и байтстаффинга в асинхронных. Битстаффинг — вставка битов, здесь — бита 0 после 5 подряд идущих битов 1. Битстаффинг работает только во время передачи информационного поля (поля данных) кадра. Если передатчик обнаруживает, что передано подряд пять единиц, то он автоматически вставляет дополнительный ноль в последовательность передаваемых битов (даже если после этих пяти единиц и так идёт ноль). Поэтому последовательность 01111110 никогда не появится в поле данных кадра. Аналогичная схема работает в приёмнике и выполняет обратную функцию. Когда после пяти единиц обнаруживается ноль, он автоматически удаляется из поля данных кадра. В байтстаффинге используется escape-последовательность, здесь — '01111101'(0x7D в шестнадцатеричном представлении), то есть байт FD(0x7E) в середине кадра заменяется последовательностью байтов (0x7D, 0x5E), а байт (0x7D) — последовательностью байтов (0x7D, 0x5D).</p>

		<p>Во время простоя среды передачи при синхронном соединении последовательность 0x7E ('01111110') постоянно передаётся по каналу для поддержания битовой синхронизации. Может иметь место совмещение последнего бита 0 одного флага и начального бита 0 следующего. Время простоя также называется межкадровым временны́м заполнением.</p>

		<p><strong>Структура кадров</strong></p>

		<p>Структура кадра HDLC, включая флаги FD:</p>

		<center><img src="../../../images/protocol/hdlc1.png"></center>

		<ul>
			<li>Флаги FD — открывающий и закрывающий флаги, представляющие собой коды 01111110, обрамляют HDLC-кадр, позволяя приёмнику определить начало и конец кадра. Благодаря этим флагам в HDLC-кадре отсутствует поле длины кадра. Иногда флаг конца одного кадра может (но не обязательно) быть начальным флагом следующего кадра.</li>
			<li>Адрес выполняет свою обычную функцию идентификации одного из нескольких возможных устройств только в конфигурациях точка-многоточка. В двухточечной конфигурации адрес HDLC используется для обозначения направления передачи — из сети к устройству пользователя (10000000) или наоборот (11000000).</li>
			<li>Управляющее поле занимает 1 или 2 байта. Его структура зависит от типа передаваемого кадра. Тип кадра определяется первыми битами управляющего поля: 0 — информационный, 01 — управляющий, 11 — ненумерованный тип. В структуру управляющего поля кадров всех типов входит бит P/F, он по-разному используется в кадрах-командах и кадрах-ответах. Например, станция-приёмник при получении от станции-передатчика кадра-команды с установленным битом P немедленно должна ответить управляющим кадром-ответом, установив бит F.</li>
			<li>Информационное поле предназначено для передачи по сети пакетов протоколов вышележащих уровней — сетевых протоколов IP, IPX, AppleTalk, DECnet, в редких случаях — прикладных протоколов, когда те выкладывают свои сообщения непосредственно в кадры канального уровня. Информационное поле может отсутствовать в управляющих кадрах и некоторых ненумерованых кадрах.</li>
			<li>Поле FCS (Frame Check Sequence) — контрольная последовательность, необходимая для обнаружения ошибок передачи. Её вычисление в основном производится методом циклического кодирования с производящим полиномом X16+X12+X5+1 (CRC-16) в соответствии с рекомендацией CCITT V.41. Полученная CRC побитово инвертируется и записывется в обратной последовательности. Это позволяет обнаруживать всевозможные кортежи ошибок длиной до 16 бит вызываемые одиночной ошибкой, а также 99,9984 % всевозможных более длинных кортежей ошибок. FCS составляется по полям Адрес, Управляющее поле, Информационное поле. В редких случаях используются другие методы циклического кодирования. После просчёта FCS на стороне приёмника он отвечает положительной или отрицательной квитанцией. Повтор кадра передающей стороной выполняется по приходу отрицательной квитанции или по истечении тайм-аута.</li>
		</ul>

		<p><strong>Типы кадров</strong></p>

		<p><strong>I-кадры (информационные кадры, кадры данных)</strong></p>

		<p>Предназначены для передачи данных пользователя. В процессе передачи информационных блоков осуществляется их нумерация в соответствии с алгоритмом скользящего окна. После установления соединения данные и положительные квитанции начинают передаваться в информационных кадрах. Логический канал HDLC является дуплексным, так что информационные кадры, а значит, и положительные квитанции могут передаваться в обоих направлениях. Если же потока информационных кадров в обратном направлении нет или же нужно передать отрицательную квитанцию, то используются управляющие кадры. При работе HDLC для обеспечения надёжности передачи используется скользящее окно размером в 7 кадров (при размере управляющего поля 1 байт) или 127 (при размере управляющего поля 2 байта). Для поддержания алгоритма окна в информационных кадрах станции-отправителя отводится 2 поля:</p>

		<ul>
			<li>N(S) — номер отправляемого кадра;</li>
			<li>N(R) — номер кадра, который станция ожидает получить от своего партнера по диалогу.</li>
		</ul>

		<p>Предположим для определённости, что станция A отправила станции B информационный кадр с некоторыми значениями NA(S) и NA(R). Если в ответ на этот кадр приходит кадр от станции B, в котором номер посланного этой станцией кадра NB(S) совпадает с номером ожидаемого станцией A кадра NA(R), то передача считается корректной. Если станция A принимает кадр-ответ, в котором номер отправленного кадра NB(S) не равен номеру ожидаемого NA(R), то станция A этот кадр отбрасывает и посылает отрицательную квитанцию REJ (от англ. reject — отказ) с номером NA(R). Приняв отрицательную квитанцию, станция B обязана повторить передачу кадра с номером NA(R), а также всех кадров с бо́льшими номерами, которые она уже успела отослать, пользуясь механизмом скользящего окна.</p>

		<p>I-кадры также содержат бит опрос/ответ P/F (poll/final). В режиме NRM ведущий терминал использует бит P для опроса, ведомый — бит F в последнем I-кадре ответа. В режимах ARM и ABM биты P/F используются для форсирования ответа.</p>

		<center><img src="../../../images/protocol/hdlc2.png"></center>

		<p><strong>S-кадры (управляющие)</strong>

		<p>Используются для контроля потока ошибок передачи. В управляющих кадрах передаются команды и ответы в контексте установленного логического соединения, в том числе запросы на повторную передачу искаженных информационных блоков:</p>

		<p><strong>Готов к приёму (RR)</strong>

		<p>Используется как положительная квитанция (до N(r)−1).</p>

		<p>Ведущая станция может сделать опрос, установив бит P.</p>

		<p>Ведомая станция на опрос может ответить кадром с установленным битом F, если у неё нет данных для передачи.</p>

		<p><strong>Не готов к приёму (RNR)</strong>

		<p>Используется как положительная квитанция и запрос остановить передачу I-кадров до получения следующего кадра RR.</p>

		<p>Ведущая или комбинированная станции могут установить бит P для уточнения статуса приёма ведомой/комбинированной станции.</p>

		<p>Ведомая/комбинированная станции могут ответить установкой бита P как индикации занятости станции.</p>

		<p><strong>Неприём (REJ)</strong>

		<p>Часто используется как отрицательная квитанция приёмника</p>

		<p>Неприём кадров последнего окна (повтор передачи с кадра N(r))</p>

		<p><strong>Выборочный неприём (SREJ)</strong>

		<p>Неприём конкретного кадра (повтор передачи одного кадра)</p>

		<center><img src="../../../images/protocol/hdlc3.png"></center>

		<p><strong>U-кадры (ненумерованные)</strong></p>

		<p>U-кадры определяются по двум младшим битам, установленным в 1. Таким образом, вместе с флагом P/F это оставляет 5 бит для типа кадра. Так как используется менее 32 значений, некоторые типы кадров имеют разный смысл в зависимости от способа отправки: как запрос или как ответ. Так, понятна связь между командой DISC (disconnect) и ответом RD (request disconnect), но причины, по которым команда SARM и ответ DM имеют одно цифровое значение, непонятны.</p>

		<p>U-кадры предназначены для установления и разрыва логического соединения, а также информирования об ошибках.</p>

		<p>Поле M ненумерованных кадров содержит коды, определяющие тип команд, которыми пользуются два узла на этапе установления соединения (например, SABME, UA, REST).</p>

		<ul>
			<li>Установка режима (SNRM, SNRME, SARM, SARME, SABM, SABME, UA, DM, RIM, SIM, RD, DISC)</li>
			<li>Ненумерованная информация (UP, UI)</li>
			<li>Восстановление (FRMR, RSET)<ul>
				<li>Неверное поле управления</li>
				<li>Превышена длина поля данных</li>
				<li>Неверная длина для данного типа кадров</li>
				<li>Неверный номер кадра</li>
			</ul></li>
			<li>Остальные (XID, TEST)</li>
		</ul>

		<center><img src="../../../images/protocol/hdlc4.png"></center>

		<p>Кадры UI, XID, TEST содержат полезные данные и могут быть использованы как в качестве команд, так и в качестве ответов.</p>

		<ul>
			<li>Кадр UI содержит пользовательскую информацию, но (в отличие от I-кадра) он передётся повторно при потере.</li>
			<li>Кадр TEST является аналогом команды ping и используется для отладочных целей. Полезные данные команды TEST возвращаются в ответе TEST.</li>
		</ul>

	</div>

</div>


</body>
</html>